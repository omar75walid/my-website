<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ุชุดุฎูุต ุจุงููุงููุฑุง</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>๐ท ุงูุชุดุฎูุต ุจุงููุงููุฑุง</h1>
  <video id="video" autoplay muted></video>
  <div id="status">๐ก ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</div>
  <div id="diagnosis"></div>
  
  

  <button onclick="restartScan()">๐ ุชุดุฎูุต ุฌุฏูุฏ</button>
  <button onclick="location.href='home.html'">๐ ุฑุฌูุน</button>
  <button onclick="toggleMode()">๐ ุงููุถุน ุงููููู/ุงูููุงุฑู</button>

  <script>
    const video = document.getElementById("video");
    const statusDiv = document.getElementById("status");
    const diagnosisDiv = document.getElementById("diagnosis");
    let audioContext, analyser, micSource, stream;
    let symptom = null;
    let quietCounter = 0;

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "ar-EG";
      window.speechSynthesis.speak(utterance);
    }

    function restartScan() {
      statusDiv.textContent = "๐ก ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...";
      diagnosisDiv.textContent = "";
      speak("ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช");
      symptom = null;
      quietCounter = 0;
    }

    async function startCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        video.srcObject = stream;

        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        micSource = audioContext.createMediaStreamSource(stream);
        micSource.connect(analyser);

        const dataArray = new Uint8Array(analyser.frequencyBinCount);

        function checkAudio() {
          analyser.getByteFrequencyData(dataArray);
          const avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;

          if (avg > 60) {
            quietCounter = 0;
            if (!symptom) {
              const rand = Math.random();
              if (rand < 0.5) {
                symptom = "ูุญุฉ";
                statusDiv.textContent = "๐คง ุชู ุงูุชุดุงู ูุญุฉ!";
                diagnosisDiv.textContent = "ุชุดุฎูุต: ุงููุญุฉ ูุฏ ุชููู ูู ุงูุจุฑุฏ ุฃู ุงูุชูุงุจ. ุงุดุฑุจ ุณูุงุฆู ุฏุงูุฆุฉ.";
                speak("ุชู ุงูุชุดุงู ูุญุฉ. ูู ุงูุฃูุถู ุดุฑุจ ุณูุงุฆู ุฏุงูุฆุฉ.");
              } else {
                symptom = "ุนุทุณ";
                statusDiv.textContent = "๐ค ุชู ุงูุชุดุงู ุนุทุณ!";
                diagnosisDiv.textContent = "ุชุดุฎูุต: ูุจุฏู ุฃูู ูุตุงุจ ุจูุฒูุฉ ุจุฑุฏ. ุฎุฐ ุฑุงุญุฉ ูุงุดุฑุจ ูุงุก.";
                speak("ุชู ุงูุชุดุงู ุนุทุณ. ูุจุฏู ุฃูู ูุตุงุจ ุจูุฒูุฉ ุจุฑุฏ.");
              }
            }
          } else {
            quietCounter++;
            if (quietCounter > 30 && symptom) {
              statusDiv.textContent = "โ ูุง ุชูุฌุฏ ุฃุนุฑุงุถ ุญุงููุงู.";
              speak("ูุง ุชูุฌุฏ ุฃุนุฑุงุถ ูุงุถุญุฉ ุญุงููุงู.");
              symptom = null;
            } else if (!symptom) {
              statusDiv.textContent = "๐ก ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...";
            }
          }

          requestAnimationFrame(checkAudio);
        }

        checkAudio();
        speak("ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช");

      } catch (err) {
        statusDiv.textContent = "โ๏ธ ุชุนุฐุฑ ุงููุตูู ุฅูู ุงููุงููุฑุง ุฃู ุงููููุฑูููู";
        console.error(err);
      }
    }

    function toggleMode() {
      document.body.classList.toggle("dark-mode");
    }

    startCamera();
  </script>
</body>
</html>
